from __future__ import annotations

from domain.scoring.exploitability import ExploitabilityInputs, compute_exploitability


def test_exploitability_breakdown_is_stable_and_in_range():
    inputs = ExploitabilityInputs(
        severity_score=90,
        recurrence_score=80,
        monetizability_score=85,
        breakout_score=75,
        opportunity_window_score=70,
        half_life_days=180,
        contradiction_score=20,
        competitive_heat_score=30,
        saturation_score=25,
    )
    r1 = compute_exploitability(inputs)
    r2 = compute_exploitability(inputs)

    assert r1.exploitability_score == r2.exploitability_score
    assert 0 <= r1.exploitability_score <= 100
    assert 0.0 <= r1.breakdown.pain_strength <= 100.0
    assert 0.0 <= r1.breakdown.timing_strength <= 100.0
    assert 0.0 <= r1.breakdown.risk_penalty <= 100.0
    assert r1.exploitability_version == "exploitability_v1"
